{% extends "portals/base.html" %}
{% load i18n %}

{% block head %}
{{ block.super }}
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}portals/portals.css" />
{% if user.is_staff %}
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}portals/jqueryminicolors/jquery.miniColors.css" />
<link type="text/css" rel="stylesheet" href="{{ STATIC_URL }}portals/jqueryfontselector/jquery.fontSelector.css" />
<link rel="stylesheet" type="text/css" href="{{ STATIC_URL }}portals/wysihtml5/bootstrap-wysihtml5.css">
{% endif %}    
{% endblock head %}
{% block main %}
    <div class="page-header">
        <h1>{{ portal.name }}</h1>
        {% if user.is_staff %}
        
        <div class="btn-toolbar">
        <div class="btn-group">
          <a class="btn btn-info dropdown-toggle" data-toggle="dropdown" href="#">
            {% trans "Manage" %}
            <span class="caret"></span>
          </a>
          <ul class="dropdown-menu">
            <li><a href="{% url portals_edit portal.pk %}" class="edit">{% trans "Edit Settings" %}</a></li>
            <li><a href="#" class="customize">{% trans "Change Theme" %}</a></li>
            <li><a href="{% url portals_manage portal.pk %}">{% trans "Manage Content" %}</a></li>
            <li class="divider"></li>
            <li><a href="{% url portals_archive portal.pk %}" class="archive">{% trans "Archive Portal" %}</a></li>
          </ul>
        </div>
     </div>
        {% endif %}
    </div>
    <div class="row">
        <div class="span12">
    {% if portal.summary %}<p id="summary">{{ portal.summary|safe }}</p>{% endif %}
        </div>
    </div>
    <div class="row">
    <div class="span6">
    {% if featured_maps %}
    <h2>{% trans "Featured Maps" %}</h2>
    <ul class="unstyled">
        {% for m in featured_maps %}
            <li>
                <a href="{{ m.map.get_absolute_url }}">{{ m.map.title }}</a>
                {% if user.is_staff %}
                <span class="actions">
                    <a href="{% url portals_toggle_map portal.slug m.map.pk %}" title="{% trans "Unfeature" %}"><i class="icon-arrow-down"></i></a>
                    <a href="{% url portals_remove_map portal.slug m.map.pk %}" title="{% trans "Remove" %}"><i class="icon-delete"></i></a>
                </span>
                {% endif %}
                {% if m.summary %}
                <p>{{ m.summary }}</p>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
    {% endif %}
    <h2>{% trans "Maps" %}</h2>
    <ul class="unstyled">
        {% for m in maps %}
            <li>
                <a href="{{ m.map.get_absolute_url }}">{{ m.map.title }}</a>
                {% if user.is_staff %}
                <span class="actions">
                    <a href="{% url portals_toggle_map portal.slug m.map.pk %}" title="{% trans "Feature" %}"><i class="icon-arrow-up"></i></a>
                    <a href="{% url portals_remove_map portal.slug m.map.pk %}" title="{% trans "Remove" %}"><i class="icon-trash"></i></a>
                </span>
                {% endif %}
                {% if m.summary %}
                <p>{{ m.summary }}</p>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
</div>
<div class="span6">
    {% if datasets %}
    <h2>{% trans "Datasets" %}</h2>
    <ul class="unstyled">
        {% for d in datasets %}
            <li>
                <a href="{{ d.dataset.get_absolute_url }}">{{ d.dataset.title }}</a>
                {% if user.is_staff %}
                <span class="actions">
                    <a href="{% url portals_remove_dataset portal.slug d.dataset.pk %}" title="{% trans "Remove" %}"><i class="icon-trash"></i></a>
                </span>
                {% endif %}
                {% if d.summary %}
                <p>{{ d.summary }}</p>
                {% endif %}
            </li>
        {% endfor %}
    </ul>
    {% endif %}
    {% if portal.links.count %}
    <h2>{% trans "Links" %}</h2>
    <ul class="unstyled">
        {% for category in portal.links.categories %}
            <li>
                <b>{{ category.label }}</b>

                {% if user.is_staff %}
                    <span class="actions">
                        <a href="{% url portals_delete_link portal.slug category.pk %}" title="{% trans "Delete" %}"><i class="icon-trash"></i></a>
                    </span>
                {% endif %}

                <ul class="unstyled sub">
                {% for link in category.children.all %}
                    <li><a href="{{ link.link }}">{{ link.label }}</a>{% if link.summary %} &mdash; {{ link.summary }}{% endif %}
                    {% if user.is_staff %}
                    <span class="actions">
                        <a href="{% url portals_delete_link portal.slug link.pk %}" title="{% trans "Delete" %}"><i class="icon-trash"></i></a>
                    </span>
                    {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>
    {% endif %}
    {% if portal.documents.count %}
    <h2>{% trans "Documents" %}</h2>
    <ul class="unstyled">
        {% for category in portal.documents.categories %}
            <li>
                <b>{{ category.label }}</b>
                {% if user.is_staff %}
                <span class="actions">
                    <a href="{% url portals_delete_document portal.slug category.pk %}" title="{% trans "Delete" %}"><i class="icon-trash"></i></a>
                </span>
                {% endif %}
                <ul class="unstyled sub">
                {% for document in category.children.all %}
                    <li><a href="{{ document.file.url }}">{{ document.label }}</a>
                    {% if user.is_staff %}
                    <span class="actions">
                        <a href="{% url portals_delete_document portal.slug document.pk %}" title="{% trans "Delete" %}"><i class="icon-trash"></i></a>
                    </span>
                    {% endif %}
                    </li>
                {% endfor %}
                </ul>
            </li>
        {% endfor %}
    </ul>
    {% endif %}
</div>
</div>
{% if user.is_staff %}
<div id="customize-modal" class="modal fade" style="display: none">
    <div class="modal-body">
    {{ portal_customize_snippet|safe }}
    </div>
</div>
{% endif %}
{% endblock main %}
{% block extra_script %}
    {% if user.is_staff %}
<script src="{{ STATIC_URL }}portals/jqueryminicolors/jquery.miniColors.min.js"></script>
<script src="{{ STATIC_URL }}portals/jqueryfontselector/jquery.fontSelector.js"></script>
<script src="{{ STATIC_URL }}portals/wysihtml5/wysihtml5-0.3.0_rc2.min.js"></script>
<script src="{{ STATIC_URL }}portals/wysihtml5/bootstrap-wysihtml5.js"></script>

<script src="{{ STATIC_URL }}portals/portal.js"></script>
    {% endif %}
{% endblock %}